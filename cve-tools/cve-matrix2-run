#!/bin/bash -x

here=$(dirname "$(readlink -f "${0}")")

out="$HOME/cve-matrix"
mkdir -p "$out"

cd "$out" || exit 1

export http_proxy="http://squid.internal:3128"
export https_proxy="https://squid.internal:3128"
export no_proxy="launchpad.net,.launchpad.net,kernel.ubuntu.com"

# Ensure we have a copy of ubuntu-cve-tracker
if [ ! -d "ubuntu-cve-tracker" ]; then
	git clone lp:~canonical-kernel-team/ubuntu-cve-tracker
else
	(cd ubuntu-cve-tracker && git pull)
fi

# Ensure we have a copy of ubuntu-security-customer-ppa-tracking.
if [ ! -d "ubuntu-security-customer-ppa-tracking" ]; then
	git clone lp:~canonical-kernel-team/ubuntu-security-customer-ppa-tracking
else
	(cd ubuntu-security-customer-ppa-tracking && git pull)
fi

"$here/cve-matrix2" "$@"
